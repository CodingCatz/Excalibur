import{countColumn as dt,Prec as pt,Facet as de,EditorState as xe,RangeSetBuilder as gt,StateEffect as mt,StateField as yt}from"./index-t9kCRchv.js";import{E as we,V as nt,S as $e,a as Se,l as kt,D as qe}from"./index-CmgkyfUy.js";const bt=1024;let xt=0;class Ne{constructor(e,t){this.from=e,this.to=t}}class b{constructor(e={}){this.id=xt++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")}),this.combine=e.combine||null}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=j.match(e)),t=>{let r=e(t);return r===void 0?null:[this,r]}}}b.closedBy=new b({deserialize:s=>s.split(" ")});b.openedBy=new b({deserialize:s=>s.split(" ")});b.group=new b({deserialize:s=>s.split(" ")});b.isolate=new b({deserialize:s=>{if(s&&s!="rtl"&&s!="ltr"&&s!="auto")throw new RangeError("Invalid value for isolate: "+s);return s||"auto"}});b.contextHash=new b({perNode:!0});b.lookAhead=new b({perNode:!0});b.mounted=new b({perNode:!0});class fe{constructor(e,t,r,n=!1){this.tree=e,this.overlay=t,this.parser=r,this.bracketed=n}static get(e){return e&&e.props&&e.props[b.mounted.id]}}const wt=Object.create(null);class j{constructor(e,t,r,n=0){this.name=e,this.props=t,this.id=r,this.flags=n}static define(e){let t=e.props&&e.props.length?Object.create(null):wt,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),n=new j(e.name||"",t,e.id,r);if(e.props){for(let i of e.props)if(Array.isArray(i)||(i=i(n)),i){if(i[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[i[0].id]=i[1]}}return n}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(b.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let r in e)for(let n of r.split(" "))t[n]=e[r];return r=>{for(let n=r.prop(b.group),i=-1;i<(n?n.length:0);i++){let l=t[i<0?r.name:n[i]];if(l)return l}}}}j.none=new j("",Object.create(null),0,8);const me=new WeakMap,Je=new WeakMap;var P;(function(s){s[s.ExcludeBuffers=1]="ExcludeBuffers",s[s.IncludeAnonymous=2]="IncludeAnonymous",s[s.IgnoreMounts=4]="IgnoreMounts",s[s.IgnoreOverlays=8]="IgnoreOverlays",s[s.EnterBracketed=16]="EnterBracketed"})(P||(P={}));class _{constructor(e,t,r,n,i){if(this.type=e,this.children=t,this.positions=r,this.length=n,this.props=null,i&&i.length){this.props=Object.create(null);for(let[l,o]of i)this.props[typeof l=="number"?l:l.id]=o}}toString(){let e=fe.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let r of this.children){let n=r.toString();n&&(t&&(t+=","),t+=n)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new Ee(this.topNode,e)}cursorAt(e,t=0,r=0){let n=me.get(this)||this.topNode,i=new Ee(n);return i.moveTo(e,t),me.set(this,i._tree),i}get topNode(){return new L(this,0,0,null)}resolve(e,t=0){let r=ue(me.get(this)||this.topNode,e,t,!1);return me.set(this,r),r}resolveInner(e,t=0){let r=ue(Je.get(this)||this.topNode,e,t,!0);return Je.set(this,r),r}resolveStack(e,t=0){return Ct(this,e,t)}iterate(e){let{enter:t,leave:r,from:n=0,to:i=this.length}=e,l=e.mode||0,o=(l&P.IncludeAnonymous)>0;for(let a=this.cursor(l|P.IncludeAnonymous);;){let u=!1;if(a.from<=i&&a.to>=n&&(!o&&a.type.isAnonymous||t(a)!==!1)){if(a.firstChild())continue;u=!0}for(;u&&r&&(o||!a.type.isAnonymous)&&r(a),!a.nextSibling();){if(!a.parent())return;u=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:He(j.none,this.children,this.positions,0,this.children.length,0,this.length,(t,r,n)=>new _(this.type,t,r,n,this.propValues),e.makeTree||((t,r,n)=>new _(j.none,t,r,n)))}static build(e){return At(e)}}_.empty=new _(j.none,[],[],0);class Le{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Le(this.buffer,this.index)}}class X{constructor(e,t,r){this.buffer=e,this.length=t,this.set=r}get type(){return j.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],r=this.buffer[e+3],n=this.set.types[t],i=n.name;if(/\W/.test(i)&&!n.isError&&(i=JSON.stringify(i)),e+=4,r==e)return i;let l=[];for(;e<r;)l.push(this.childString(e)),e=this.buffer[e+3];return i+"("+l.join(",")+")"}findChild(e,t,r,n,i){let{buffer:l}=this,o=-1;for(let a=e;a!=t&&!(it(i,n,l[a+1],l[a+2])&&(o=a,r>0));a=l[a+3]);return o}slice(e,t,r){let n=this.buffer,i=new Uint16Array(t-e),l=0;for(let o=e,a=0;o<t;){i[a++]=n[o++],i[a++]=n[o++]-r;let u=i[a++]=n[o++]-r;i[a++]=n[o++]-e,l=Math.max(l,u)}return new X(i,l,this.set)}}function it(s,e,t,r){switch(s){case-2:return t<e;case-1:return r>=e&&t<e;case 0:return t<e&&r>e;case 1:return t<=e&&r>e;case 2:return r>e;case 4:return!0}}function ue(s,e,t,r){for(var n;s.from==s.to||(t<1?s.from>=e:s.from>e)||(t>-1?s.to<=e:s.to<e);){let l=!r&&s instanceof L&&s.index<0?null:s.parent;if(!l)return s;s=l}let i=r?0:P.IgnoreOverlays;if(r)for(let l=s,o=l.parent;o;l=o,o=l.parent)l instanceof L&&l.index<0&&((n=o.enter(e,t,i))===null||n===void 0?void 0:n.from)!=l.from&&(s=o);for(;;){let l=s.enter(e,t,i);if(!l)return s;s=l}}class st{cursor(e=0){return new Ee(this,e)}getChild(e,t=null,r=null){let n=Ke(this,e,t,r);return n.length?n[0]:null}getChildren(e,t=null,r=null){return Ke(this,e,t,r)}resolve(e,t=0){return ue(this,e,t,!1)}resolveInner(e,t=0){return ue(this,e,t,!0)}matchContext(e){return _e(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),r=this;for(;t;){let n=t.lastChild;if(!n||n.to!=t.to)break;n.type.isError&&n.from==n.to?(r=t,t=n.prevSibling):t=n}return r}get node(){return this}get next(){return this.parent}}class L extends st{constructor(e,t,r,n){super(),this._tree=e,this.from=t,this.index=r,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,r,n,i=0){for(let l=this;;){for(let{children:o,positions:a}=l._tree,u=t>0?o.length:-1;e!=u;e+=t){let f=o[e],c=a[e]+l.from,g;if(!(!(i&P.EnterBracketed&&f instanceof _&&(g=fe.get(f))&&!g.overlay&&g.bracketed&&r>=c&&r<=c+f.length)&&!it(n,r,c,c+f.length))){if(f instanceof X){if(i&P.ExcludeBuffers)continue;let k=f.findChild(0,f.buffer.length,t,r-c,n);if(k>-1)return new Q(new vt(l,f,e,c),null,k)}else if(i&P.IncludeAnonymous||!f.type.isAnonymous||je(f)){let k;if(!(i&P.IgnoreMounts)&&(k=fe.get(f))&&!k.overlay)return new L(k.tree,c,e,l);let w=new L(f,c,e,l);return i&P.IncludeAnonymous||!w.type.isAnonymous?w:w.nextChild(t<0?f.children.length-1:0,t,r,n,i)}}}if(i&P.IncludeAnonymous||!l.type.isAnonymous||(l.index>=0?e=l.index+t:e=t<0?-1:l._parent._tree.children.length,l=l._parent,!l))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}prop(e){return this._tree.prop(e)}enter(e,t,r=0){let n;if(!(r&P.IgnoreOverlays)&&(n=fe.get(this._tree))&&n.overlay){let i=e-this.from,l=r&P.EnterBracketed&&n.bracketed;for(let{from:o,to:a}of n.overlay)if((t>0||l?o<=i:o<i)&&(t<0||l?a>=i:a>i))return new L(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function Ke(s,e,t,r){let n=s.cursor(),i=[];if(!n.firstChild())return i;if(t!=null){for(let l=!1;!l;)if(l=n.type.is(t),!n.nextSibling())return i}for(;;){if(r!=null&&n.type.is(r))return i;if(n.type.is(e)&&i.push(n.node),!n.nextSibling())return r==null?i:[]}}function _e(s,e,t=e.length-1){for(let r=s;t>=0;r=r.parent){if(!r)return!1;if(!r.type.isAnonymous){if(e[t]&&e[t]!=r.name)return!1;t--}}return!0}class vt{constructor(e,t,r,n){this.parent=e,this.buffer=t,this.index=r,this.start=n}}class Q extends st{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,r){super(),this.context=e,this._parent=t,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}child(e,t,r){let{buffer:n}=this.context,i=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.context.start,r);return i<0?null:new Q(this.context,this,i)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}prop(e){return this.type.prop(e)}enter(e,t,r=0){if(r&P.ExcludeBuffers)return null;let{buffer:n}=this.context,i=n.findChild(this.index+4,n.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return i<0?null:new Q(this.context,this,i)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new Q(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new Q(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:r}=this.context,n=this.index+4,i=r.buffer[this.index+3];if(i>n){let l=r.buffer[this.index+1];e.push(r.slice(n,i,l)),t.push(0)}return new _(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function lt(s){if(!s.length)return null;let e=0,t=s[0];for(let i=1;i<s.length;i++){let l=s[i];(l.from>t.from||l.to<t.to)&&(t=l,e=i)}let r=t instanceof L&&t.index<0?null:t.parent,n=s.slice();return r?n[e]=r:n.splice(e,1),new St(n,t)}class St{constructor(e,t){this.heads=e,this.node=t}get next(){return lt(this.heads)}}function Ct(s,e,t){let r=s.resolveInner(e,t),n=null;for(let i=r instanceof L?r:r.context.parent;i;i=i.parent)if(i.index<0){let l=i.parent;(n||(n=[r])).push(l.resolve(e,t)),i=l}else{let l=fe.get(i.tree);if(l&&l.overlay&&l.overlay[0].from<=e&&l.overlay[l.overlay.length-1].to>=e){let o=new L(l.tree,l.overlay[0].from+i.from,-1,i);(n||(n=[r])).push(ue(o,e,t,!1))}}return n?lt(n):r}class Ee{get name(){return this.type.name}constructor(e,t=0){if(this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,this.mode=t&~P.EnterBracketed,e instanceof L)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let r=e._parent;r;r=r._parent)this.stack.unshift(r.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:r,buffer:n}=this.buffer;return this.type=t||n.set.types[n.buffer[e]],this.from=r+n.buffer[e+1],this.to=r+n.buffer[e+2],!0}yield(e){return e?e instanceof L?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,r,this.mode));let{buffer:n}=this.buffer,i=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.buffer.start,r);return i<0?!1:(this.stack.push(this.index),this.yieldBuf(i))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,r=this.mode){return this.buffer?r&P.ExcludeBuffers?!1:this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&P.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&P.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,r=this.stack.length-1;if(e<0){let n=r<0?0:this.stack[r]+4;if(this.index!=n)return this.yieldBuf(t.findChild(n,this.index,-1,0,4))}else{let n=t.buffer[this.index+3];if(n<(r<0?t.buffer.length:t.buffer[this.stack[r]+3]))return this.yieldBuf(n)}return r<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,r,{buffer:n}=this;if(n){if(e>0){if(this.index<n.buffer.buffer.length)return!1}else for(let i=0;i<this.index;i++)if(n.buffer.buffer[i+3]<this.index)return!1;({index:t,parent:r}=n)}else({index:t,_parent:r}=this._tree);for(;r;{index:t,_parent:r}=r)if(t>-1)for(let i=t+e,l=e<0?-1:r._tree.children.length;i!=l;i+=e){let o=r._tree.children[i];if(this.mode&P.IncludeAnonymous||o instanceof X||!o.type.isAnonymous||je(o))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,r=0;if(e&&e.context==this.buffer)e:for(let n=this.index,i=this.stack.length;i>=0;){for(let l=e;l;l=l._parent)if(l.index==n){if(n==this.index)return l;t=l,r=i+1;break e}n=this.stack[--i]}for(let n=r;n<this.stack.length;n++)t=new Q(this.buffer,t,this.stack[n]);return this.bufferNode=new Q(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let r=0;;){let n=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){r++;continue}this.type.isAnonymous||(n=!0)}for(;;){if(n&&t&&t(this),n=this.type.isAnonymous,!r)return;if(this.nextSibling())break;this.parent(),r--,n=!0}}}matchContext(e){if(!this.buffer)return _e(this.node.parent,e);let{buffer:t}=this.buffer,{types:r}=t.set;for(let n=e.length-1,i=this.stack.length-1;n>=0;i--){if(i<0)return _e(this._tree,e,n);let l=r[t.buffer[this.stack[i]]];if(!l.isAnonymous){if(e[n]&&e[n]!=l.name)return!1;n--}}return!0}}function je(s){return s.children.some(e=>e instanceof X||!e.type.isAnonymous||je(e))}function At(s){var e;let{buffer:t,nodeSet:r,maxBufferLength:n=bt,reused:i=[],minRepeatType:l=r.types.length}=s,o=Array.isArray(t)?new Le(t,t.length):t,a=r.types,u=0,f=0;function c(x,C,d,N,v,B){let{id:y,start:p,end:S,size:A}=o,O=f,J=u;if(A<0)if(o.next(),A==-1){let q=i[y];d.push(q),N.push(p-x);return}else if(A==-3){u=y;return}else if(A==-4){f=y;return}else throw new RangeError(`Unrecognized record size: ${A}`);let le=a[y],pe,Y,Ue=p-x;if(S-p<=n&&(Y=D(o.pos-C,v))){let q=new Uint16Array(Y.size-Y.skip),M=o.pos-Y.size,F=q.length;for(;o.pos>M;)F=E(Y.start,q,F);pe=new X(q,S-Y.start,r),Ue=Y.start-x}else{let q=o.pos-A;o.next();let M=[],F=[],Z=y>=l?y:-1,ne=0,ge=S;for(;o.pos>q;)Z>=0&&o.id==Z&&o.size>=0?(o.end<=ge-n&&(w(M,F,p,ne,o.end,ge,Z,O,J),ne=M.length,ge=o.end),o.next()):B>2500?g(p,q,M,F):c(p,q,M,F,Z,B+1);if(Z>=0&&ne>0&&ne<M.length&&w(M,F,p,ne,p,ge,Z,O,J),M.reverse(),F.reverse(),Z>-1&&ne>0){let Ve=k(le,J);pe=He(le,M,F,0,M.length,0,S-p,Ve,Ve)}else pe=T(le,M,F,S-p,O-S,J)}d.push(pe),N.push(Ue)}function g(x,C,d,N){let v=[],B=0,y=-1;for(;o.pos>C;){let{id:p,start:S,end:A,size:O}=o;if(O>4)o.next();else{if(y>-1&&S<y)break;y<0&&(y=A-n),v.push(p,S,A),B++,o.next()}}if(B){let p=new Uint16Array(B*4),S=v[v.length-2];for(let A=v.length-3,O=0;A>=0;A-=3)p[O++]=v[A],p[O++]=v[A+1]-S,p[O++]=v[A+2]-S,p[O++]=O;d.push(new X(p,v[2]-S,r)),N.push(S-x)}}function k(x,C){return(d,N,v)=>{let B=0,y=d.length-1,p,S;if(y>=0&&(p=d[y])instanceof _){if(!y&&p.type==x&&p.length==v)return p;(S=p.prop(b.lookAhead))&&(B=N[y]+p.length+S)}return T(x,d,N,v,B,C)}}function w(x,C,d,N,v,B,y,p,S){let A=[],O=[];for(;x.length>N;)A.push(x.pop()),O.push(C.pop()+d-v);x.push(T(r.types[y],A,O,B-v,p-B,S)),C.push(v-d)}function T(x,C,d,N,v,B,y){if(B){let p=[b.contextHash,B];y=y?[p].concat(y):[p]}if(v>25){let p=[b.lookAhead,v];y=y?[p].concat(y):[p]}return new _(x,C,d,N,y)}function D(x,C){let d=o.fork(),N=0,v=0,B=0,y=d.end-n,p={size:0,start:0,skip:0};e:for(let S=d.pos-x;d.pos>S;){let A=d.size;if(d.id==C&&A>=0){p.size=N,p.start=v,p.skip=B,B+=4,N+=4,d.next();continue}let O=d.pos-A;if(A<0||O<S||d.start<y)break;let J=d.id>=l?4:0,le=d.start;for(d.next();d.pos>O;){if(d.size<0)if(d.size==-3||d.size==-4)J+=4;else break e;else d.id>=l&&(J+=4);d.next()}v=le,N+=A,B+=J}return(C<0||N==x)&&(p.size=N,p.start=v,p.skip=B),p.size>4?p:void 0}function E(x,C,d){let{id:N,start:v,end:B,size:y}=o;if(o.next(),y>=0&&N<l){let p=d;if(y>4){let S=o.pos-(y-4);for(;o.pos>S;)d=E(x,C,d)}C[--d]=p,C[--d]=B-x,C[--d]=v-x,C[--d]=N}else y==-3?u=N:y==-4&&(f=N);return d}let z=[],I=[];for(;o.pos>0;)c(s.start||0,s.bufferStart||0,z,I,-1,0);let H=(e=s.length)!==null&&e!==void 0?e:z.length?I[0]+z[0].length:0;return new _(a[s.topID],z.reverse(),I.reverse(),H)}const Ge=new WeakMap;function ve(s,e){if(!s.isAnonymous||e instanceof X||e.type!=s)return 1;let t=Ge.get(e);if(t==null){t=1;for(let r of e.children){if(r.type!=s||!(r instanceof _)){t=1;break}t+=ve(s,r)}Ge.set(e,t)}return t}function He(s,e,t,r,n,i,l,o,a){let u=0;for(let w=r;w<n;w++)u+=ve(s,e[w]);let f=Math.ceil(u*1.5/8),c=[],g=[];function k(w,T,D,E,z){for(let I=D;I<E;){let H=I,x=T[I],C=ve(s,w[I]);for(I++;I<E;I++){let d=ve(s,w[I]);if(C+d>=f)break;C+=d}if(I==H+1){if(C>f){let d=w[H];k(d.children,d.positions,0,d.children.length,T[H]+z);continue}c.push(w[H])}else{let d=T[I-1]+w[I-1].length-x;c.push(He(s,w,T,H,I,x,d,null,a))}g.push(x+z-i)}}return k(e,t,r,n,0),(o||a)(c,g,l)}class te{constructor(e,t,r,n,i=!1,l=!1){this.from=e,this.to=t,this.tree=r,this.offset=n,this.open=(i?1:0)|(l?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],r=!1){let n=[new te(0,e.length,e,0,!1,r)];for(let i of t)i.to>e.length&&n.push(i);return n}static applyChanges(e,t,r=128){if(!t.length)return e;let n=[],i=1,l=e.length?e[0]:null;for(let o=0,a=0,u=0;;o++){let f=o<t.length?t[o]:null,c=f?f.fromA:1e9;if(c-a>=r)for(;l&&l.from<c;){let g=l;if(a>=g.from||c<=g.to||u){let k=Math.max(g.from,a)-u,w=Math.min(g.to,c)-u;g=k>=w?null:new te(k,w,g.tree,g.offset+u,o>0,!!f)}if(g&&n.push(g),l.to>c)break;l=i<e.length?e[i++]:null}if(!f)break;a=f.toA,u=f.toA-f.toB}return n}}class Nt{startParse(e,t,r){return typeof e=="string"&&(e=new Bt(e)),r=r?r.length?r.map(n=>new Ne(n.from,n.to)):[new Ne(0,0)]:[new Ne(0,e.length)],this.createParse(e,t||[],r)}parse(e,t,r){let n=this.startParse(e,t,r);for(;;){let i=n.advance();if(i)return i}}}class Bt{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new b({perNode:!0});let Pt=0;class R{constructor(e,t,r,n){this.name=e,this.set=t,this.base=r,this.modified=n,this.id=Pt++}toString(){let{name:e}=this;for(let t of this.modified)t.name&&(e=`${t.name}(${e})`);return e}static define(e,t){let r=typeof e=="string"?e:"?";if(e instanceof R&&(t=e),t?.base)throw new Error("Can not derive from a modified tag");let n=new R(r,[],null,[]);if(n.set.push(n),t)for(let i of t.set)n.set.push(i);return n}static defineModifier(e){let t=new Ce(e);return r=>r.modified.indexOf(t)>-1?r:Ce.get(r.base||r,r.modified.concat(t).sort((n,i)=>n.id-i.id))}}let It=0;class Ce{constructor(e){this.name=e,this.instances=[],this.id=It++}static get(e,t){if(!t.length)return e;let r=t[0].instances.find(o=>o.base==e&&Tt(t,o.modified));if(r)return r;let n=[],i=new R(e.name,n,e,t);for(let o of t)o.instances.push(i);let l=Ot(t);for(let o of e.set)if(!o.modified.length)for(let a of l)n.push(Ce.get(o,a));return i}}function Tt(s,e){return s.length==e.length&&s.every((t,r)=>t==e[r])}function Ot(s){let e=[[]];for(let t=0;t<s.length;t++)for(let r=0,n=e.length;r<n;r++)e.push(e[r].concat(s[t]));return e.sort((t,r)=>r.length-t.length)}function _t(s){let e=Object.create(null);for(let t in s){let r=s[t];Array.isArray(r)||(r=[r]);for(let n of t.split(" "))if(n){let i=[],l=2,o=n;for(let c=0;;){if(o=="..."&&c>0&&c+3==n.length){l=1;break}let g=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(o);if(!g)throw new RangeError("Invalid path: "+n);if(i.push(g[0]=="*"?"":g[0][0]=='"'?JSON.parse(g[0]):g[0]),c+=g[0].length,c==n.length)break;let k=n[c++];if(c==n.length&&k=="!"){l=0;break}if(k!="/")throw new RangeError("Invalid path: "+n);o=n.slice(c)}let a=i.length-1,u=i[a];if(!u)throw new RangeError("Invalid path: "+n);let f=new ce(r,l,a>0?i.slice(0,a):null);e[u]=f.sort(e[u])}}return ot.add(e)}const ot=new b({combine(s,e){let t,r,n;for(;s||e;){if(!s||e&&s.depth>=e.depth?(n=e,e=e.next):(n=s,s=s.next),t&&t.mode==n.mode&&!n.context&&!t.context)continue;let i=new ce(n.tags,n.mode,n.context);t?t.next=i:r=i,t=i}return r}});class ce{constructor(e,t,r,n){this.tags=e,this.mode=t,this.context=r,this.next=n}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}ce.empty=new ce([],2,null);function at(s,e){let t=Object.create(null);for(let i of s)if(!Array.isArray(i.tag))t[i.tag.id]=i.class;else for(let l of i.tag)t[l.id]=i.class;let{scope:r,all:n=null}=e||{};return{style:i=>{let l=n;for(let o of i)for(let a of o.set){let u=t[a.id];if(u){l=l?l+" "+u:u;break}}return l},scope:r}}function Et(s,e){let t=null;for(let r of s){let n=r.style(e);n&&(t=t?t+" "+n:n)}return t}function zt(s,e,t,r=0,n=s.length){let i=new Dt(r,Array.isArray(e)?e:[e],t);i.highlightRange(s.cursor(),r,n,"",i.highlighters),i.flush(n)}class Dt{constructor(e,t,r){this.at=e,this.highlighters=t,this.span=r,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,r,n,i){let{type:l,from:o,to:a}=e;if(o>=r||a<=t)return;l.isTop&&(i=this.highlighters.filter(k=>!k.scope||k.scope(l)));let u=n,f=Mt(e)||ce.empty,c=Et(i,f.tags);if(c&&(u&&(u+=" "),u+=c,f.mode==1&&(n+=(n?" ":"")+c)),this.startSpan(Math.max(t,o),u),f.opaque)return;let g=e.tree&&e.tree.prop(b.mounted);if(g&&g.overlay){let k=e.node.enter(g.overlay[0].from+o,1),w=this.highlighters.filter(D=>!D.scope||D.scope(g.tree.type)),T=e.firstChild();for(let D=0,E=o;;D++){let z=D<g.overlay.length?g.overlay[D]:null,I=z?z.from+o:a,H=Math.max(t,E),x=Math.min(r,I);if(H<x&&T)for(;e.from<x&&(this.highlightRange(e,H,x,n,i),this.startSpan(Math.min(x,e.to),u),!(e.to>=I||!e.nextSibling())););if(!z||I>r)break;E=z.to+o,E>t&&(this.highlightRange(k.cursor(),Math.max(t,z.from+o),Math.min(r,E),"",w),this.startSpan(Math.min(r,E),u))}T&&e.parent()}else if(e.firstChild()){g&&(n="");do if(!(e.to<=t)){if(e.from>=r)break;this.highlightRange(e,t,r,n,i),this.startSpan(Math.min(r,e.to),u)}while(e.nextSibling());e.parent()}}}function Mt(s){let e=s.type.prop(ot);for(;e&&e.context&&!s.matchContext(e.context);)e=e.next;return e||null}const h=R.define,ye=h(),K=h(),Qe=h(K),Xe=h(K),G=h(),ke=h(G),Be=h(G),V=h(),ee=h(V),W=h(),U=h(),ze=h(),oe=h(ze),be=h(),m={comment:ye,lineComment:h(ye),blockComment:h(ye),docComment:h(ye),name:K,variableName:h(K),typeName:Qe,tagName:h(Qe),propertyName:Xe,attributeName:h(Xe),className:h(K),labelName:h(K),namespace:h(K),macroName:h(K),literal:G,string:ke,docString:h(ke),character:h(ke),attributeValue:h(ke),number:Be,integer:h(Be),float:h(Be),bool:h(G),regexp:h(G),escape:h(G),color:h(G),url:h(G),keyword:W,self:h(W),null:h(W),atom:h(W),unit:h(W),modifier:h(W),operatorKeyword:h(W),controlKeyword:h(W),definitionKeyword:h(W),moduleKeyword:h(W),operator:U,derefOperator:h(U),arithmeticOperator:h(U),logicOperator:h(U),bitwiseOperator:h(U),compareOperator:h(U),updateOperator:h(U),definitionOperator:h(U),typeOperator:h(U),controlOperator:h(U),punctuation:ze,separator:h(ze),bracket:oe,angleBracket:h(oe),squareBracket:h(oe),paren:h(oe),brace:h(oe),content:V,heading:ee,heading1:h(ee),heading2:h(ee),heading3:h(ee),heading4:h(ee),heading5:h(ee),heading6:h(ee),contentSeparator:h(V),list:h(V),quote:h(V),emphasis:h(V),strong:h(V),link:h(V),monospace:h(V),strikethrough:h(V),inserted:h(),deleted:h(),changed:h(),invalid:h(),meta:be,documentMeta:h(be),annotation:h(be),processingInstruction:h(be),definition:R.defineModifier("definition"),constant:R.defineModifier("constant"),function:R.defineModifier("function"),standard:R.defineModifier("standard"),local:R.defineModifier("local"),special:R.defineModifier("special")};for(let s in m){let e=m[s];e instanceof R&&(e.name=s)}at([{tag:m.link,class:"tok-link"},{tag:m.heading,class:"tok-heading"},{tag:m.emphasis,class:"tok-emphasis"},{tag:m.strong,class:"tok-strong"},{tag:m.keyword,class:"tok-keyword"},{tag:m.atom,class:"tok-atom"},{tag:m.bool,class:"tok-bool"},{tag:m.url,class:"tok-url"},{tag:m.labelName,class:"tok-labelName"},{tag:m.inserted,class:"tok-inserted"},{tag:m.deleted,class:"tok-deleted"},{tag:m.literal,class:"tok-literal"},{tag:m.string,class:"tok-string"},{tag:m.number,class:"tok-number"},{tag:[m.regexp,m.escape,m.special(m.string)],class:"tok-string2"},{tag:m.variableName,class:"tok-variableName"},{tag:m.local(m.variableName),class:"tok-variableName tok-local"},{tag:m.definition(m.variableName),class:"tok-variableName tok-definition"},{tag:m.special(m.variableName),class:"tok-variableName2"},{tag:m.definition(m.propertyName),class:"tok-propertyName tok-definition"},{tag:m.typeName,class:"tok-typeName"},{tag:m.namespace,class:"tok-namespace"},{tag:m.className,class:"tok-className"},{tag:m.macroName,class:"tok-macroName"},{tag:m.propertyName,class:"tok-propertyName"},{tag:m.operator,class:"tok-operator"},{tag:m.comment,class:"tok-comment"},{tag:m.meta,class:"tok-meta"},{tag:m.invalid,class:"tok-invalid"},{tag:m.punctuation,class:"tok-punctuation"}]);var Pe;const he=new b,Rt=new b;class ${constructor(e,t,r=[],n=""){this.data=e,this.name=n,xe.prototype.hasOwnProperty("tree")||Object.defineProperty(xe.prototype,"tree",{get(){return re(this)}}),this.parser=t,this.extension=[se.of(this),xe.languageData.of((i,l,o)=>{let a=Ye(i,l,o),u=a.type.prop(he);if(!u)return[];let f=i.facet(u),c=a.type.prop(Rt);if(c){let g=a.resolve(l-a.from,o);for(let k of c)if(k.test(g,i)){let w=i.facet(k.facet);return k.type=="replace"?w:w.concat(f)}}return f})].concat(r)}isActiveAt(e,t,r=-1){return Ye(e,t,r).type.prop(he)==this.data}findRegions(e){let t=e.facet(se);if(t?.data==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let r=[],n=(i,l)=>{if(i.prop(he)==this.data){r.push({from:l,to:l+i.length});return}let o=i.prop(b.mounted);if(o){if(o.tree.prop(he)==this.data){if(o.overlay)for(let a of o.overlay)r.push({from:a.from+l,to:a.to+l});else r.push({from:l,to:l+i.length});return}else if(o.overlay){let a=r.length;if(n(o.tree,o.overlay[0].from+l),r.length>a)return}}for(let a=0;a<i.children.length;a++){let u=i.children[a];u instanceof _&&n(u,i.positions[a]+l)}};return n(re(e),0),r}get allowsNesting(){return!0}}$.setState=mt.define();function Ye(s,e,t){let r=s.facet(se),n=re(s).topNode;if(!r||r.allowsNesting)for(let i=n;i;i=i.enter(e,t,P.ExcludeBuffers|P.EnterBracketed))i.type.isTop&&(n=i);return n}function re(s){let e=s.field($.state,!1);return e?e.tree:_.empty}class Lt{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let r=this.cursorPos-this.string.length;return e<r||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-r,t-r)}}let ae=null;class Ae{constructor(e,t,r=[],n,i,l,o,a){this.parser=e,this.state=t,this.fragments=r,this.tree=n,this.treeLen=i,this.viewport=l,this.skipped=o,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}static create(e,t,r){return new Ae(e,t,[],_.empty,0,r,[],null)}startParse(){return this.parser.startParse(new Lt(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=_.empty&&this.isDone(t??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var r;if(typeof e=="number"){let n=Date.now()+e;e=()=>Date.now()>n}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let n=this.parse.advance();if(n)if(this.fragments=this.withoutTempSkipped(te.addTree(n,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(r=this.parse.stoppedAt)!==null&&r!==void 0?r:this.state.doc.length,this.tree=n,this.parse=null,this.treeLen<(t??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(te.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=ae;ae=this;try{return e()}finally{ae=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=Ze(e,t.from,t.to);return e}changes(e,t){let{fragments:r,tree:n,treeLen:i,viewport:l,skipped:o}=this;if(this.takeTree(),!e.empty){let a=[];if(e.iterChangedRanges((u,f,c,g)=>a.push({fromA:u,toA:f,fromB:c,toB:g})),r=te.applyChanges(r,a),n=_.empty,i=0,l={from:e.mapPos(l.from,-1),to:e.mapPos(l.to,1)},this.skipped.length){o=[];for(let u of this.skipped){let f=e.mapPos(u.from,1),c=e.mapPos(u.to,-1);f<c&&o.push({from:f,to:c})}}}return new Ae(this.parser,t,r,n,i,l,o,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let r=0;r<this.skipped.length;r++){let{from:n,to:i}=this.skipped[r];n<e.to&&i>e.from&&(this.fragments=Ze(this.fragments,n,i),this.skipped.splice(r--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends Nt{createParse(t,r,n){let i=n[0].from,l=n[n.length-1].to;return{parsedPos:i,advance(){let a=ae;if(a){for(let u of n)a.tempSkipped.push(u);e&&(a.scheduleOn=a.scheduleOn?Promise.all([a.scheduleOn,e]):e)}return this.parsedPos=l,new _(j.none,[],[],l-i)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return ae}}function Ze(s,e,t){return te.applyChanges(s,[{fromA:e,toA:t,fromB:e,toB:t}])}class ie{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),r=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,r)||t.takeTree(),new ie(t)}static init(e){let t=Math.min(3e3,e.doc.length),r=Ae.create(e.facet(se).parser,e,{from:0,to:t});return r.work(20,t)||r.takeTree(),new ie(r)}}$.state=yt.define({create:ie.init,update(s,e){for(let t of e.effects)if(t.is($.setState))return t.value;return e.startState.facet(se)!=e.state.facet(se)?ie.init(e.state):s.apply(e)}});let ht=s=>{let e=setTimeout(()=>s(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(ht=s=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(s,{timeout:400})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});const Ie=typeof navigator<"u"&&(!((Pe=navigator.scheduling)===null||Pe===void 0)&&Pe.isInputPending)?()=>navigator.scheduling.isInputPending():null,jt=nt.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field($.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field($.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=ht(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:r,viewport:{to:n}}=this.view,i=r.field($.state);if(i.tree==i.context.tree&&i.context.isDone(n+1e5))return;let l=Date.now()+Math.min(this.chunkBudget,100,e&&!Ie?Math.max(25,e.timeRemaining()-5):1e9),o=i.context.treeLen<n&&r.doc.length>n+1e3,a=i.context.work(()=>Ie&&Ie()||Date.now()>l,n+(o?0:1e5));this.chunkBudget-=Date.now()-t,(a||this.chunkBudget<=0)&&(i.context.takeTree(),this.view.dispatch({effects:$.setState.of(new ie(i.context))})),this.chunkBudget>0&&!(a&&!o)&&this.scheduleWork(),this.checkAsyncSchedule(i.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>kt(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),se=de.define({combine(s){return s.length?s[0]:null},enables:s=>[$.state,jt,we.contentAttributes.compute([s],e=>{let t=e.facet(s);return t&&t.name?{"data-language":t.name}:{}})]}),Ht=de.define(),ft=de.define({combine:s=>{if(!s.length)return"  ";let e=s[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(s[0]));return e}});function Ft(s){let e=s.facet(ft);return e.charCodeAt(0)==9?s.tabSize*e.length:e.length}function fr(s,e){let t="",r=s.tabSize,n=s.facet(ft)[0];if(n=="	"){for(;e>=r;)t+="	",e-=r;n=" "}for(let i=0;i<e;i++)t+=n;return t}function ur(s,e){s instanceof xe&&(s=new ut(s));for(let r of s.state.facet(Ht)){let n=r(s,e);if(n!==void 0)return n}let t=re(s.state);return t.length>=e?Ut(s,t,e):null}class ut{constructor(e,t={}){this.state=e,this.options=t,this.unit=Ft(e)}lineAt(e,t=1){let r=this.state.doc.lineAt(e),{simulateBreak:n,simulateDoubleBreak:i}=this.options;return n!=null&&n>=r.from&&n<=r.to?i&&n==e?{text:"",from:e}:(t<0?n<e:n<=e)?{text:r.text.slice(n-r.from),from:n}:{text:r.text.slice(0,n-r.from),from:r.from}:r}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:r,from:n}=this.lineAt(e,t);return r.slice(e-n,Math.min(r.length,e+100-n))}column(e,t=1){let{text:r,from:n}=this.lineAt(e,t),i=this.countColumn(r,e-n),l=this.options.overrideIndentation?this.options.overrideIndentation(n):-1;return l>-1&&(i+=l-this.countColumn(r,r.search(/\S|$/))),i}countColumn(e,t=e.length){return dt(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:r,from:n}=this.lineAt(e,t),i=this.options.overrideIndentation;if(i){let l=i(n);if(l>-1)return l}return this.countColumn(r,r.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const Wt=new b;function Ut(s,e,t){let r=e.resolveStack(t),n=e.resolveInner(t,-1).resolve(t,0).enterUnfinishedNodesBefore(t);if(n!=r.node){let i=[];for(let l=n;l&&!(l.from<r.node.from||l.to>r.node.to||l.from==r.node.from&&l.type==r.node.type);l=l.parent)i.push(l);for(let l=i.length-1;l>=0;l--)r={node:i[l],next:r}}return ct(r,s,t)}function ct(s,e,t){for(let r=s;r;r=r.next){let n=$t(r.node);if(n)return n(Fe.create(e,t,r))}return 0}function Vt(s){return s.pos==s.options.simulateBreak&&s.options.simulateDoubleBreak}function $t(s){let e=s.type.prop(Wt);if(e)return e;let t=s.firstChild,r;if(t&&(r=t.type.prop(b.closedBy))){let n=s.lastChild,i=n&&r.indexOf(n.name)>-1;return l=>Gt(l,!0,1,void 0,i&&!Vt(l)?n.from:void 0)}return s.parent==null?qt:null}function qt(){return 0}class Fe extends ut{constructor(e,t,r){super(e.state,e.options),this.base=e,this.pos=t,this.context=r}get node(){return this.context.node}static create(e,t,r){return new Fe(e,t,r)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let r=e.resolve(t.from);for(;r.parent&&r.parent.from==r.from;)r=r.parent;if(Jt(r,e))break;t=this.state.doc.lineAt(r.from)}return this.lineIndent(t.from)}continue(){return ct(this.context.next,this.base,this.pos)}}function Jt(s,e){for(let t=e;t;t=t.parent)if(s==t)return!0;return!1}function Kt(s){let e=s.node,t=e.childAfter(e.from),r=e.lastChild;if(!t)return null;let n=s.options.simulateBreak,i=s.state.doc.lineAt(t.from),l=n==null||n<=i.from?i.to:Math.min(i.to,n);for(let o=t.to;;){let a=e.childAfter(o);if(!a||a==r)return null;if(!a.type.isSkipped){if(a.from>=l)return null;let u=/^ */.exec(i.text.slice(t.to-i.from))[0].length;return{from:t.from,to:t.to+u}}o=a.to}}function Gt(s,e,t,r,n){let i=s.textAfter,l=i.match(/^\s*/)[0].length,o=r&&i.slice(l,l+r.length)==r||n==s.pos+l,a=Kt(s);return a?o?s.column(a.from):s.column(a.to):s.baseIndent+(o?0:s.unit*t)}class We{constructor(e,t){this.specs=e;let r;function n(o){let a=$e.newName();return(r||(r=Object.create(null)))["."+a]=o,a}const i=typeof t.all=="string"?t.all:t.all?n(t.all):void 0,l=t.scope;this.scope=l instanceof $?o=>o.prop(he)==l.data:l?o=>o==l:void 0,this.style=at(e.map(o=>({tag:o.tag,class:o.class||n(Object.assign({},o,{tag:null}))})),{all:i}).style,this.module=r?new $e(r):null,this.themeType=t.themeType}static define(e,t){return new We(e,t||{})}}const De=de.define(),Qt=de.define({combine(s){return s.length?[s[0]]:null}});function Te(s){let e=s.facet(De);return e.length?e:s.facet(Qt)}function cr(s,e){let t=[Yt],r;return s instanceof We&&(s.module&&t.push(we.styleModule.of(s.module)),r=s.themeType),r?t.push(De.computeN([we.darkTheme],n=>n.facet(we.darkTheme)==(r=="dark")?[s]:[])):t.push(De.of(s)),t}class Xt{constructor(e){this.markCache=Object.create(null),this.tree=re(e.state),this.decorations=this.buildDeco(e,Te(e.state)),this.decoratedTo=e.viewport.to}update(e){let t=re(e.state),r=Te(e.state),n=r!=Te(e.startState),{viewport:i}=e.view,l=e.changes.mapPos(this.decoratedTo,1);t.length<i.to&&!n&&t.type==this.tree.type&&l>=i.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=l):(t!=this.tree||e.viewportChanged||n)&&(this.tree=t,this.decorations=this.buildDeco(e.view,r),this.decoratedTo=i.to)}buildDeco(e,t){if(!t||!this.tree.length)return Se.none;let r=new gt;for(let{from:n,to:i}of e.visibleRanges)zt(this.tree,t,(l,o,a)=>{r.add(l,o,this.markCache[a]||(this.markCache[a]=Se.mark({class:a})))},n,i);return r.finish()}}const Yt=pt.high(nt.fromClass(Xt,{decorations:s=>s.decorations})),Zt=1e4,er="()[]{}",tr=new b;function Me(s,e,t){let r=s.prop(e<0?b.openedBy:b.closedBy);if(r)return r;if(s.name.length==1){let n=t.indexOf(s.name);if(n>-1&&n%2==(e<0?1:0))return[t[n+e]]}return null}function Re(s){let e=s.type.prop(tr);return e?e(s.node):s}function dr(s,e,t,r={}){let n=r.maxScanDistance||Zt,i=r.brackets||er,l=re(s),o=l.resolveInner(e,t);for(let a=o;a;a=a.parent){let u=Me(a.type,t,i);if(u&&a.from<a.to){let f=Re(a);if(f&&(t>0?e>=f.from&&e<f.to:e>f.from&&e<=f.to))return rr(s,e,t,a,f,u,i)}}return nr(s,e,t,l,o.type,n,i)}function rr(s,e,t,r,n,i,l){let o=r.parent,a={from:n.from,to:n.to},u=0,f=o?.cursor();if(f&&(t<0?f.childBefore(r.from):f.childAfter(r.to)))do if(t<0?f.to<=r.from:f.from>=r.to){if(u==0&&i.indexOf(f.type.name)>-1&&f.from<f.to){let c=Re(f);return{start:a,end:c?{from:c.from,to:c.to}:void 0,matched:!0}}else if(Me(f.type,t,l))u++;else if(Me(f.type,-t,l)){if(u==0){let c=Re(f);return{start:a,end:c&&c.from<c.to?{from:c.from,to:c.to}:void 0,matched:!1}}u--}}while(t<0?f.prevSibling():f.nextSibling());return{start:a,matched:!1}}function nr(s,e,t,r,n,i,l){let o=t<0?s.sliceDoc(e-1,e):s.sliceDoc(e,e+1),a=l.indexOf(o);if(a<0||a%2==0!=t>0)return null;let u={from:t<0?e-1:e,to:t>0?e+1:e},f=s.doc.iterRange(e,t>0?s.doc.length:0),c=0;for(let g=0;!f.next().done&&g<=i;){let k=f.value;t<0&&(g+=k.length);let w=e+g*t;for(let T=t>0?0:k.length-1,D=t>0?k.length:-1;T!=D;T+=t){let E=l.indexOf(k[T]);if(!(E<0||r.resolveInner(w+T,1).type!=n))if(E%2==0==t>0)c++;else{if(c==1)return{start:u,end:{from:w+T,to:w+T+1},matched:E>>1==a>>1};c--}}t>0&&(g+=k.length)}return f.done?{start:u,matched:!1}:null}const ir=Object.create(null),et=[j.none],tt=[],rt=Object.create(null),sr=Object.create(null);for(let[s,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])sr[s]=lr(ir,e);function Oe(s,e){tt.indexOf(s)>-1||(tt.push(s),console.warn(e))}function lr(s,e){let t=[];for(let o of e.split(" ")){let a=[];for(let u of o.split(".")){let f=s[u]||m[u];f?typeof f=="function"?a.length?a=a.map(f):Oe(u,`Modifier ${u} used at start of tag`):a.length?Oe(u,`Tag ${u} used as modifier`):a=Array.isArray(f)?f:[f]:Oe(u,`Unknown highlighting tag ${u}`)}for(let u of a)t.push(u)}if(!t.length)return 0;let r=e.replace(/ /g,"_"),n=r+" "+t.map(o=>o.id),i=rt[n];if(i)return i.id;let l=rt[n]=j.define({id:et.length,name:r,props:[_t({[r]:t})]});return et.push(l),l.id}qe.RTL,qe.LTR;export{We as H,ut as I,b as N,Ft as a,ft as b,cr as c,ur as g,fr as i,dr as m,re as s,m as t};
