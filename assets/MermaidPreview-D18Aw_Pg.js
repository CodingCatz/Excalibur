const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CmgkyfUy.js","assets/index-t9kCRchv.js","assets/index-Vcq4gwWv.js","assets/index-CEx7gjRs.js","assets/index-C8_CR6uQ.js","assets/index-CzAJa9R-.js"])))=>i.map(i=>d[i]);
import{M,a as z,b as A,c as F}from"./useUndoRedoKeys-CBEPday8.js";import{c as P,aZ as H,a_ as b,aB as V,r as l,j as n,a$ as j,b0 as C,B as T,b1 as R,b2 as B,b3 as G,b4 as L,b5 as S}from"./index-BO31ZqPg.js";import{c as O}from"./createHistorySlice-BPQGD6VD.js";import{E as K}from"./waypoints-Bd-eVwOl.js";import{C as X}from"./copy-Nwklh3jE.js";const Y=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],$=P("rotate-ccw",Y);function q(d){return d.map(({measured:o,...i})=>i)}const U={start:"Start",end:"End",process:"Process",decision:"Decision?",state:"State",subflow:"Sub Flow",note:"Note",group:"Group"},se=H()((...d)=>{const[o,i]=d;return{...O(e=>({nodes:q(e.nodes),edges:e.edges}),e=>({nodes:e.nodes,edges:e.edges}))(...d),nodes:[],edges:[],viewport:{x:0,y:0,zoom:1},defaultEdgeType:"smoothstep",editingSubFlowId:null,onNodesChange(e){const s=i();for(const t of e){if(t.type==="position"&&t.dragging&&!s._isDragging){s.pushSnapshot(),o({_isDragging:!0});break}if(t.type==="position"&&!t.dragging&&s._isDragging){o({_isDragging:!1});break}}e.some(t=>t.type==="remove")&&s.pushSnapshot(),o({nodes:F(e,s.nodes)})},onEdgesChange(e){const s=i();e.some(t=>t.type==="remove")&&s.pushSnapshot(),o({edges:A(e,s.edges)})},onConnect(e){i().pushSnapshot();const s=i().defaultEdgeType;o({edges:z({...e,id:b(),type:s},i().edges)})},setViewport(e){o({viewport:e})},addNode(e,s,t){i().pushSnapshot();const r={id:b(),type:e,position:s,data:{label:t??U[e]}};o(c=>({nodes:[...c.nodes,r]}))},updateNodeData(e,s){i().pushSnapshot(),o(t=>({nodes:t.nodes.map(r=>r.id===e?{...r,data:{...r.data,...s}}:r)}))},changeNodeType(e,s){i().pushSnapshot(),o(t=>({nodes:t.nodes.map(r=>r.id===e?{...r,type:s}:r)}))},removeNode(e){i().pushSnapshot(),o(s=>({nodes:s.nodes.filter(t=>t.id!==e),edges:s.edges.filter(t=>t.source!==e&&t.target!==e)}))},removeSelected(){i().pushSnapshot(),o(e=>{const s=new Set(e.nodes.filter(t=>t.selected).map(t=>t.id));return{nodes:e.nodes.filter(t=>!t.selected),edges:e.edges.filter(t=>!t.selected&&!s.has(t.source)&&!s.has(t.target))}})},setDefaultEdgeType(e){o({defaultEdgeType:e})},updateEdgeType(e,s){i().pushSnapshot(),o(t=>({edges:t.edges.map(r=>r.id===e?{...r,type:s}:r)}))},updateEdgeLabel(e,s){i().pushSnapshot(),o(t=>({edges:t.edges.map(r=>r.id===e?{...r,label:s||void 0}:r)}))},toggleEdgeBidirectional(e){i().pushSnapshot(),o(s=>({edges:s.edges.map(t=>{if(t.id!==e)return t;const r=!!t.markerStart;return{...t,markerStart:r?void 0:{type:M.ArrowClosed,width:24,height:24}}})}))},removeEdge(e){i().pushSnapshot(),o(s=>({edges:s.edges.filter(t=>t.id!==e)}))},setEditingSubFlowId(e){o({editingSubFlowId:e})},updateSubFlow(e,s,t,r){i().pushSnapshot(),o(c=>({nodes:c.nodes.map(u=>u.id===e?{...u,data:{...u.data,subNodes:s,subEdges:t,subViewport:r}}:u)}))},createGroup(){const e=i().nodes.filter(a=>a.selected&&a.type!=="group");if(e.length<2)return;i().pushSnapshot();const s=40,t=30;let r=1/0,c=1/0,u=-1/0,p=-1/0;for(const a of e){const E=a.measured?.width??a.width??150,g=a.measured?.height??a.height??60;r=Math.min(r,a.position.x),c=Math.min(c,a.position.y),u=Math.max(u,a.position.x+E),p=Math.max(p,a.position.y+g)}const x=b(),f=r-s,y=c-s-t,v={id:x,type:"group",position:{x:f,y},data:{label:"Group",groupTitle:"Group"},style:{width:u-r+s*2,height:p-c+s*2+t}},w=i().nodes.map(a=>!a.selected||a.type==="group"?{...a,selected:!1}:{...a,parentId:x,extent:"parent",position:{x:a.position.x-f,y:a.position.y-y},selected:!1});o({nodes:[v,...w]})},ungroupNodes(e){const s=i().nodes.find(t=>t.id===e);s&&(i().pushSnapshot(),o({nodes:i().nodes.filter(t=>t.id!==e).map(t=>t.parentId!==e?t:{...t,parentId:void 0,extent:void 0,position:{x:t.position.x+s.position.x,y:t.position.y+s.position.y}})}))},loadFlow(e,s,t){o({nodes:e.map(r=>r.selected?{...r,selected:!1}:r),edges:s.map(r=>r.selected?{...r,selected:!1}:r),viewport:t}),i().clearHistory()},reset(){o({nodes:[],edges:[],viewport:{x:0,y:0,zoom:1},editingSubFlowId:null}),i().clearHistory()}}});L.initialize({startOnLoad:!1,theme:"dark",securityLevel:"loose"});function re({code:d}){const o=V(),[i,h]=l.useState(!1),[e,s]=l.useState("code"),[t,r]=l.useState(null),[c,u]=l.useState(null),p=l.useRef(null),x=l.useRef(d);l.useEffect(()=>{x.current!==d&&(x.current=d,r(null))},[d]);const f=t??d;l.useEffect(()=>{if(e!=="preview"||!p.current)return;let a=!1;async function E(){try{const{svg:g}=await L.render(`mermaid-preview-${Date.now()}`,f);!a&&p.current&&(p.current.innerHTML=g,u(null))}catch(g){!a&&p.current&&(p.current.innerHTML="",u(g instanceof Error?g.message:"Render error"))}}return E(),()=>{a=!0}},[f,e]);async function y(){await navigator.clipboard.writeText(f),h(!0),setTimeout(()=>h(!1),2e3)}function v(){r(null)}const w=t!==null;return n.jsxs("div",{className:"flex flex-col border-t bg-muted/30",children:[n.jsxs("div",{className:"flex items-center justify-between px-3 py-1.5",children:[n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Mermaid"}),w&&n.jsx("span",{className:"rounded bg-amber-500/20 px-1 py-0.5 text-[10px] text-amber-600 dark:text-amber-400",children:o("mermaid.modified")})]}),n.jsxs("div",{className:"flex gap-0.5",children:[w&&n.jsxs(j,{children:[n.jsx(C,{asChild:!0,children:n.jsx(T,{variant:"ghost",size:"icon",className:"size-6",onClick:v,children:n.jsx($,{className:"size-3"})})}),n.jsx(R,{children:o("mermaid.reset")})]}),n.jsxs(j,{children:[n.jsx(C,{asChild:!0,children:n.jsx(T,{variant:"ghost",size:"icon",className:"size-6",onClick:()=>s(e==="preview"?"code":"preview"),children:e==="preview"?n.jsx(B,{className:"size-3"}):n.jsx(K,{className:"size-3"})})}),n.jsx(R,{children:o(e==="preview"?"mermaid.editCode":"mermaid.preview")})]}),n.jsxs(j,{children:[n.jsx(C,{asChild:!0,children:n.jsx(T,{variant:"ghost",size:"icon",className:"size-6",onClick:y,children:i?n.jsx(G,{className:"size-3 text-green-500"}):n.jsx(X,{className:"size-3"})})}),n.jsx(R,{children:o("mermaid.copy")})]})]})]}),e==="preview"?n.jsxs("div",{className:"max-h-48 overflow-auto px-3 pb-3",children:[n.jsx("div",{ref:p,className:"[&_svg]:max-w-full"}),c&&n.jsx("span",{className:"text-xs text-destructive",children:c})]}):n.jsx(Z,{code:f,onChange:r})]})}function Z({code:d,onChange:o}){const i=l.useRef(null),h=l.useRef(null),[e,s]=l.useState(!1),t=l.useRef(o);t.current=o,l.useEffect(()=>{if(!i.current)return;let c=null;async function u(){const{EditorView:p,keymap:x,lineNumbers:f,highlightActiveLine:y}=await S(async()=>{const{EditorView:m,keymap:N,lineNumbers:_,highlightActiveLine:k}=await import("./index-CmgkyfUy.js").then(I=>I.i);return{EditorView:m,keymap:N,lineNumbers:_,highlightActiveLine:k}},__vite__mapDeps([0,1,2])),{EditorState:v}=await S(async()=>{const{EditorState:m}=await import("./index-t9kCRchv.js");return{EditorState:m}},[]),{defaultKeymap:w,history:a,historyKeymap:E}=await S(async()=>{const{defaultKeymap:m,history:N,historyKeymap:_}=await import("./index-CEx7gjRs.js");return{defaultKeymap:m,history:N,historyKeymap:_}},__vite__mapDeps([3,1,0,2,4])),{oneDark:g}=await S(async()=>{const{oneDark:m}=await import("./index-CzAJa9R-.js");return{oneDark:m}},__vite__mapDeps([5,0,1,2,4]));if(!i.current)return;const D=p.updateListener.of(m=>{m.docChanged&&t.current(m.state.doc.toString())});c=new p({state:v.create({doc:d,extensions:[f(),y(),a(),x.of([...w,...E]),g,D,p.theme({"&":{fontSize:"12px",maxHeight:"192px"},".cm-scroller":{overflow:"auto"},".cm-content":{fontFamily:"monospace"}})]}),parent:i.current}),h.current=c,s(!0)}return u(),()=>{c?.destroy(),h.current=null}},[]);const r=l.useRef(d);return l.useEffect(()=>{if(!h.current||!e||r.current===d)return;r.current=d;const c=h.current.state.doc.toString();c!==d&&h.current.dispatch({changes:{from:0,to:c.length,insert:d}})},[d,e]),n.jsx("div",{ref:i,className:"max-h-48 overflow-hidden border-t px-1 pb-1"})}export{re as M,$ as R,se as u};
