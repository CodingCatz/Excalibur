import{c as k,j as e,aZ as q,a_ as Q,r as d,S as $,c5 as Y,c1 as Z,B as w,aB as G,X as ee,I as y,ar as te,bN as se,aF as ae,bL as ie,aH as re,bV as oe,c6 as ne,c7 as le,c4 as ce,bW as V,c8 as de,aM as he,bX as me,a$ as M,b0 as S,b1 as _,bQ as L,b6 as ue,b7 as xe,b8 as pe,c9 as J,ba as ge}from"./index-BO31ZqPg.js";import{c as be,N as fe,i as we,B as je,d as ye,u as ve,e as Ne,R as ke}from"./useUndoRedoKeys-CBEPday8.js";import{u as ze,I as Ce,T as Te}from"./useAutoSave-CfhZAdWB.js";import{u as De,U as Me,R as Se,D as _e,S as Ie}from"./useDocumentSwitch-B2mv6tdu.js";import{c as Re,Z as We,M as Ee,a as Ae,S as Pe}from"./createHistorySlice-BPQGD6VD.js";import{H as Be}from"./house-D4_r5Lde.js";import{U as He}from"./user-BWss316X.js";import{R as Oe}from"./rectangle-horizontal-C4_MwUlU.js";import{T as Ue,M as Fe}from"./type-CgJifwFr.js";import{L as $e}from"./list-DKnF4tiR.js";import"./value-kwUSg1GE.js";import"./useReadmeHelp-Dp5zdwnQ.js";const Ve=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 15h18",key:"5xshup"}]],Le=k("panel-bottom",Ve);const Je=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}]],Ze=k("panel-top",Je);const Ge=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],Ke=k("settings-2",Ge);const Xe=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["line",{x1:"12",x2:"12.01",y1:"18",y2:"18",key:"1dp563"}]],qe=k("tablet",Xe);const Qe=[["path",{d:"M12 20h-1a2 2 0 0 1-2-2 2 2 0 0 1-2 2H6",key:"1528k5"}],["path",{d:"M13 8h7a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-7",key:"13ksps"}],["path",{d:"M5 16H4a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h1",key:"1n9rhb"}],["path",{d:"M6 4h1a2 2 0 0 1 2 2 2 2 0 0 1 2-2h1",key:"1mj8rg"}],["path",{d:"M9 6v12",key:"velyjx"}]],Ye=k("text-cursor-input",Qe);function et({data:l}){return e.jsx("div",{className:"rounded-lg bg-white shadow-lg",style:{width:l.width,height:l.height,border:"1px solid #e4e4e7"}})}function tt(l){return l.map(({measured:t,...c})=>c)}const K={button:{width:200,height:44,label:"Button"},text:{width:200,height:30,label:"Text"},input:{width:250,height:40,label:"Input"},image:{width:200,height:150,label:"Image"},list:{width:250,height:200,label:"List"},navbar:{width:375,height:56,label:"NavBar"},tabbar:{width:375,height:50,label:"TabBar"},container:{width:300,height:200,label:"Container"}},I=q()((...l)=>{const[t,c]=l;return{...Re(s=>({nodes:tt(s.nodes),artboard:s.artboard}),s=>({nodes:s.nodes,artboard:s.artboard}))(...l),nodes:[],viewport:{x:0,y:0,zoom:1},artboard:{width:375,height:812},onNodesChange(s){const a=c();for(const r of s){if(r.type==="position"&&r.dragging&&!a._isDragging){a.pushSnapshot(),t({_isDragging:!0});break}if(r.type==="position"&&!r.dragging&&a._isDragging){t({_isDragging:!1});break}}s.some(r=>r.type==="remove")&&a.pushSnapshot(),t({nodes:be(s,a.nodes)})},setViewport(s){t({viewport:s})},addWidget(s,a){c().pushSnapshot();const r=K[s],o={id:Q(),type:"widget",position:a,data:{label:r.label,widgetType:s,width:r.width,height:r.height},style:{width:r.width,height:r.height}};t(m=>({nodes:[...m.nodes,o]}))},updateWidgetData(s,a){c().pushSnapshot(),t(r=>({nodes:r.nodes.map(o=>{if(o.id!==s)return o;const m={...o,data:{...o.data,...a}};return(a.width!==void 0||a.height!==void 0)&&(m.style={...o.style,width:a.width??o.data.width,height:a.height??o.data.height}),m})}))},removeSelected(){c().pushSnapshot(),t(s=>({nodes:s.nodes.filter(a=>!a.selected)}))},setArtboard(s,a){c().pushSnapshot(),t(r=>({artboard:{width:s,height:a},nodes:r.nodes.map(o=>o.type==="artboard"?{...o,data:{...o.data,width:s,height:a},style:{width:s,height:a}}:o)}))},loadWireframe(s,a,r){t({nodes:s.map(o=>o.selected?{...o,selected:!1}:o),viewport:a,artboard:r}),c().clearHistory()},reset(){t({nodes:[],viewport:{x:0,y:0,zoom:1},artboard:{width:375,height:812}}),c().clearHistory()}}});function st({id:l,data:t,selected:c}){const[x,s]=d.useState(!1),[a,r]=d.useState(t.label),o=d.useRef(null),m=I(h=>h.updateWidgetData),n=d.useCallback(()=>{r(t.label),s(!0),setTimeout(()=>o.current?.focus(),0)},[t.label]),p=d.useCallback(()=>{s(!1);const h=a.trim();h&&h!==t.label&&m(l,{label:h})},[a,t.label,l,m]),b=d.useCallback(h=>{h.key==="Enter"&&p(),h.key==="Escape"&&(r(t.label),s(!1))},[p,t.label]),v=d.useCallback((h,T)=>{m(l,{width:Math.round(T.width),height:Math.round(T.height)})},[l,m]),z=t.width,j=t.height,R=x?e.jsx("input",{ref:o,className:"w-full bg-transparent text-center text-xs outline-none",value:a,onChange:h=>r(h.target.value),onBlur:p,onKeyDown:b}):null,C=t.clickAction?e.jsx("div",{className:"absolute -top-2 -right-2 rounded-full bg-blue-500 px-1.5 py-0.5 text-[8px] font-medium text-white leading-none",children:"tap"}):null;return e.jsxs(e.Fragment,{children:[e.jsx(fe,{isVisible:!!c,minWidth:40,minHeight:24,onResize:v,handleClassName:"!bg-blue-400 !size-2 !rounded-sm",lineClassName:"!border-blue-400"}),e.jsxs("div",{className:"relative",style:{width:z,height:j},onDoubleClick:n,children:[C,at(t,x,R)]})]})}function at(l,t,c){const{widgetType:x,label:s,height:a}=l;switch(x){case"button":return e.jsx("div",{className:"flex size-full items-center justify-center rounded-lg bg-blue-500 text-white shadow-sm",children:t?c:e.jsx("span",{className:"text-xs font-medium",children:s})});case"text":return e.jsx("div",{className:"flex size-full items-start px-1",children:t?c:e.jsx("span",{className:"text-sm text-zinc-800",children:s})});case"input":return e.jsx("div",{className:"flex size-full items-center rounded-md border border-zinc-300 bg-zinc-50 px-2",children:t?c:e.jsx("span",{className:"text-xs text-zinc-400",children:l.placeholder||s})});case"image":return e.jsxs("div",{className:"flex size-full flex-col items-center justify-center rounded-md bg-zinc-200 text-zinc-400",children:[e.jsx(Z,{className:"size-6"}),t?c:e.jsx("span",{className:"mt-1 text-[10px]",children:s})]});case"list":return e.jsxs("div",{className:"flex size-full flex-col overflow-hidden rounded-md border border-zinc-200 bg-white",children:[e.jsx("div",{className:"border-b border-zinc-200 px-2 py-1.5",children:t?c:e.jsx("span",{className:"text-xs font-medium text-zinc-700",children:s})}),Array.from({length:Math.max(1,Math.floor((a-28)/32))}).map((r,o)=>e.jsx("div",{className:"border-b border-zinc-100 px-2 py-2 last:border-b-0",children:e.jsx("div",{className:"h-2 w-3/4 rounded bg-zinc-200"})},o))]});case"navbar":return e.jsxs("div",{className:"flex size-full items-center justify-between rounded-t-lg bg-zinc-800 px-3 text-white",children:[e.jsx(Y,{className:"size-4"}),t?c:e.jsx("span",{className:"text-xs font-medium",children:s}),e.jsx($,{className:"size-4"})]});case"tabbar":return e.jsxs("div",{className:"flex size-full items-center justify-around rounded-b-lg border-t border-zinc-200 bg-white text-zinc-500",children:[[Be,$,He].map((r,o)=>e.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[e.jsx(r,{className:"size-4"}),e.jsxs("span",{className:"text-[8px]",children:["Tab ",o+1]})]},o)),t&&e.jsx("div",{className:"absolute inset-x-0 top-0",children:c})]});case"container":return e.jsx("div",{className:"size-full rounded-md border-2 border-dashed border-zinc-300 p-2",children:t?c:e.jsx("span",{className:"text-[10px] text-zinc-400",children:s})});default:return e.jsx("div",{className:"flex size-full items-center justify-center border border-zinc-300 bg-white",children:e.jsx("span",{className:"text-xs",children:s})})}}const it={artboard:et,widget:st};function rt(){const{nodes:l,viewport:t,onNodesChange:c,setViewport:x,addWidget:s}=I(),a=d.useCallback(m=>{m.preventDefault();const n=m.dataTransfer.getData("application/wireframe-widget");if(!n)return;const p=m.currentTarget.getBoundingClientRect(),b={x:(m.clientX-p.left-t.x)/t.zoom,y:(m.clientY-p.top-t.y)/t.zoom};s(n,b)},[s,t]),r=d.useCallback(m=>{m.preventDefault(),m.dataTransfer.dropEffect="move"},[]),o=d.useCallback((m,n)=>x(n),[x]);return e.jsxs("div",{className:"absolute inset-0",onDrop:a,onDragOver:r,children:[e.jsx(we,{nodes:l,edges:[],nodeTypes:it,onNodesChange:c,onMoveEnd:o,defaultViewport:t,fitView:l.length>0,snapToGrid:!0,snapGrid:[8,8],deleteKeyCode:["Backspace","Delete"],proOptions:{hideAttribution:!0},className:"bg-zinc-100",children:e.jsx(je,{variant:ye.Dots,gap:16,size:1,color:"#d4d4d8"})}),e.jsx(ot,{})]})}function ot(){const{zoomIn:l,zoomOut:t,fitView:c}=ve();return e.jsxs("div",{className:"absolute bottom-3 left-1/2 z-10 flex -translate-x-1/2 items-center gap-1 rounded-lg border bg-background/80 p-1 shadow-md backdrop-blur",children:[e.jsx(w,{variant:"ghost",size:"icon",className:"size-7",onClick:()=>t(),children:e.jsx(We,{className:"size-3.5"})}),e.jsx(w,{variant:"ghost",size:"icon",className:"size-7",onClick:()=>c({padding:.2}),children:e.jsx(Ee,{className:"size-3.5"})}),e.jsx(w,{variant:"ghost",size:"icon",className:"size-7",onClick:()=>l(),children:e.jsx(Ae,{className:"size-3.5"})})]})}function nt({nodeId:l,data:t,onClose:c}){const x=G(),s=I(n=>n.updateWidgetData),a=d.useCallback(n=>s(l,n),[l,s]),r=d.useCallback(()=>{const n=[...t.items??[],`Item ${(t.items?.length??0)+1}`];a({items:n})},[t.items,a]),o=d.useCallback(n=>{const p=(t.items??[]).filter((b,v)=>v!==n);a({items:p})},[t.items,a]),m=d.useCallback((n,p)=>{const b=[...t.items??[]];b[n]=p,a({items:b})},[t.items,a]);return e.jsxs("div",{className:"shrink-0 border-t bg-background",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-1.5",children:[e.jsx("span",{className:"text-xs font-semibold capitalize",children:t.widgetType}),e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:t.label}),e.jsx("div",{className:"flex-1"}),e.jsx("button",{className:"rounded p-0.5 hover:bg-accent",onClick:c,children:e.jsx(ee,{className:"size-3.5"})})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto px-4 pb-3",children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-4 gap-y-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[e.jsx(N,{label:"Label",children:e.jsx(y,{className:"h-7 text-xs",value:t.label,onChange:n=>a({label:n.target.value})})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{label:"W",children:e.jsx(y,{type:"number",className:"h-7 text-xs",value:t.width,onChange:n=>a({width:Number(n.target.value)||t.width})})}),e.jsx(N,{label:"H",children:e.jsx(y,{type:"number",className:"h-7 text-xs",value:t.height,onChange:n=>a({height:Number(n.target.value)||t.height})})})]}),(t.widgetType==="text"||t.widgetType==="button")&&e.jsx(N,{label:"Text",children:e.jsx(y,{className:"h-7 text-xs",value:t.text??"",onChange:n=>a({text:n.target.value})})}),t.widgetType==="input"&&e.jsx(N,{label:"Placeholder",children:e.jsx(y,{className:"h-7 text-xs",value:t.placeholder??"",onChange:n=>a({placeholder:n.target.value})})}),t.widgetType==="list"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] font-medium uppercase text-muted-foreground",children:"Items"}),e.jsx(w,{variant:"ghost",size:"icon",className:"size-5",onClick:r,children:e.jsx(te,{className:"size-3"})})]}),e.jsx("div",{className:"space-y-1 max-h-20 overflow-y-auto",children:(t.items??[]).map((n,p)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"h-6 flex-1 text-xs",value:n,onChange:b=>m(p,b.target.value)}),e.jsx("button",{className:"rounded p-0.5 hover:bg-accent",onClick:()=>o(p),children:e.jsx(se,{className:"size-3 text-muted-foreground"})})]},p))})]}),e.jsx(N,{label:x("wireframe.clickAction"),children:e.jsx(y,{className:"h-7 text-xs",placeholder:x("wireframe.clickActionHint"),value:t.clickAction??"",onChange:n=>a({clickAction:n.target.value})})})]})})]})}function N({label:l,children:t}){return e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-[11px] font-medium text-muted-foreground",children:l}),t]})}const lt=[{type:"button",icon:Oe,color:"#3b82f6"},{type:"text",icon:Ue,color:"#71717a"},{type:"input",icon:Ye,color:"#a3a3a3"},{type:"image",icon:Z,color:"#8b5cf6"},{type:"list",icon:$e,color:"#f59e0b"},{type:"navbar",icon:Ze,color:"#27272a"},{type:"tabbar",icon:Le,color:"#27272a"},{type:"container",icon:Pe,color:"#d4d4d8"}],ct=[{label:"iPhone",width:375,height:812,icon:J},{label:"Android",width:360,height:800,icon:J},{label:"iPad",width:768,height:1024,icon:qe},{label:"Desktop",width:1280,height:800,icon:Fe}];function vt(){const{docId:l}=ae(),t=G(),c=ie(),{currentDocument:x}=re(),{nodes:s,viewport:a,artboard:r,loadWireframe:o,addWidget:m,setArtboard:n,undo:p,redo:b,_past:v,_future:z}=I();Ne(p,b);const j=d.useMemo(()=>s.find(u=>u.selected&&u.type==="widget")??null,[s]),[R,C]=d.useState(!1);d.useEffect(()=>{j&&C(!0)},[j?.id]),d.useEffect(()=>{if(x?.type==="wireframe"){const i=x,u={id:"__artboard__",type:"artboard",position:{x:0,y:0},selectable:!1,draggable:!1,data:{label:"Artboard",widgetType:"container",width:i.artboard.width,height:i.artboard.height},style:{width:i.artboard.width,height:i.artboard.height}},g=(i.nodes??[]).map(f=>({...f,style:{width:f.data.width,height:f.data.height,...f.style}}));o([u,...g],i.viewport,i.artboard)}},[x?.id]);const h=d.useMemo(()=>{if(!x||x.type!=="wireframe")return null;const i=s.filter(u=>u.type==="widget");return{...x,nodes:i.map(u=>({id:u.id,type:u.type,position:u.position,data:u.data,style:u.style})),viewport:a,artboard:r,updatedAt:Date.now()}},[x,s,a,r]),T=ze(h),W=De(l,T),E=d.useCallback(i=>{const u=K[i],g=r.width/2-u.width/2+(Math.random()-.5)*40,f=r.height/2-u.height/2+(Math.random()-.5)*40;m(i,{x:Math.round(g/8)*8,y:Math.round(f/8)*8})},[m,r]),A=d.useCallback((i,u)=>{i.dataTransfer.setData("application/wireframe-widget",u),i.dataTransfer.effectAllowed="move"},[]),P=d.useCallback(async i=>{if(await c({title:t("ie.importConfirm"),variant:"destructive"}))try{const g=JSON.parse(i);if(g.type!=="wireframe")return;const f={id:"__artboard__",type:"artboard",position:{x:0,y:0},selectable:!1,draggable:!1,data:{label:"Artboard",widgetType:"container",width:g.artboard.width,height:g.artboard.height},style:{width:g.artboard.width,height:g.artboard.height}},X=(g.nodes??[]).map(D=>({...D,style:{width:D.data.width,height:D.data.height,...D.style}}));o([f,...X],g.viewport,g.artboard)}catch{}},[c,t,o]),B=d.useCallback(()=>{h&&oe(`${h.title||"wireframe"}.json`,h)},[h]),H=d.useCallback(async()=>{if(!h)return;const i=h.nodes??[],u=await ne(i,h.artboard),g=URL.createObjectURL(u),f=document.createElement("a");f.href=g,f.download=`${h.title||"wireframe"}.png`,f.click(),URL.revokeObjectURL(g)},[h]),O=d.useCallback(()=>{if(!h)return;const i=le(h);ce(`${h.title||"wireframe"}.md`,i)},[h]),U=d.useMemo(()=>[{key:"ie.importJson",icon:V,accept:".json",onImport:P}],[P]),F=d.useMemo(()=>[{key:"export.currentPng",icon:de,onClick:H},{key:"export.currentMd",icon:he,onClick:O},{key:"export.currentJson",icon:V,onClick:B}],[H,O,B]);return me(l?e.jsxs(e.Fragment,{children:[e.jsxs(M,{children:[e.jsx(S,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"icon",className:"size-9",onClick:p,disabled:v.length===0,children:e.jsx(Me,{className:"size-4"})})}),e.jsx(_,{side:"top",children:"Undo"})]}),e.jsxs(M,{children:[e.jsx(S,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"icon",className:"size-9",onClick:b,disabled:z.length===0,children:e.jsx(Se,{className:"size-4"})})}),e.jsx(_,{side:"top",children:"Redo"})]}),e.jsx(L,{orientation:"vertical",className:"mx-0.5 h-6"}),lt.map(i=>e.jsxs(M,{children:[e.jsx(S,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"icon",className:"size-9",draggable:!0,onDragStart:u=>A(u,i.type),onClick:()=>E(i.type),children:e.jsx(i.icon,{className:"size-4",style:{color:i.color}})})}),e.jsx(_,{side:"top",children:i.type})]},i.type)),e.jsx(L,{orientation:"vertical",className:"mx-0.5 h-6"}),e.jsxs(ue,{children:[e.jsxs(M,{children:[e.jsx(S,{asChild:!0,children:e.jsx(xe,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"icon",className:"size-9",children:e.jsx(Ke,{className:"size-4"})})})}),e.jsx(_,{side:"top",children:t("wireframe.artboard")})]}),e.jsx(pe,{side:"top",align:"start",children:ct.map(i=>e.jsxs(ge,{onClick:()=>n(i.width,i.height),children:[e.jsx(i.icon,{className:"mr-2 size-4"}),i.label," (",i.width,"×",i.height,")"]},i.label))})]}),e.jsx(Ce,{imports:U,exports:F}),e.jsx(Te,{section:"UI 線框圖"})]}):null,[l,E,A,r,U,F,p,b,v,z,t]),l?e.jsx(ke,{children:e.jsxs("div",{className:"relative flex flex-col size-full",children:[e.jsx("div",{className:"relative min-h-0 flex-1",children:e.jsx(rt,{})}),R&&j&&e.jsx(nt,{nodeId:j.id,data:j.data,onClose:()=>C(!1)}),W!=="idle"&&e.jsx(Ie,{status:W})]})}):e.jsx(_e,{docTypes:["wireframe"],routePath:"wireframe",defaultDocType:"wireframe"})}export{vt as default};
